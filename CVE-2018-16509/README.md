# GhostScript Sandbox Bypass Command Execution (CVE-2018-16509)

## Ghost Script설명
<span style="font-size: 12px">GhostScript는 Adobe Systems의 PostScript 와 PDF page description languages를 해석하는 인터프리터 기반의 소프트웨어이다.  
ImageMagick과 Python PIL 과 같은 image processing library에 널리 쓰인다. </span><br><br>
  


## 취약점
<span style="font-size: 12px"> CVE-2018-16509 취약점은 9.24 이전 버전의 Artifect Ghostscript에서 발견된 권한 상승 취약점으로
/invalidaccess 예외 처리 시 부적절한 restoration of privilege 검증이 수행되어 발생한다.  
공격자는 특정 코드를 실행하기 위해 pipe 명령어를 사용한 조작된 PostScript를 이용해 공격할 수 있다.</span><br><br>


## 환경 설정

<span style="font-size: 12px"> docker-compose.yml과 index.php를 다운 받고 다음과 같은 명령어 입력을 통해 취약한 환경을 시작할 수 있다.</span>  
```
docker compose up -d
```
<span style="font-size: 12px"> 서버가 시작된 뒤 http://your-ip:8080에서 업로드 요소를 확인할 수 있다. </span><br><br>


## 취약점 확인
<span style="font-size: 12px"> 
http://your-ip:8080에 접속하면 다음과 같은 화면을 확인할 수 있다.<br>

![Image](https://github.com/user-attachments/assets/7fbd85d8-494f-4b4f-ac6a-476f7f4ad48a)

poc.png 파일은 `id > /tmp/success && cat /tmp/success`를 수행하는 파일이다.<br>
해당 화면에서 poc.png를 제출하면 다음과 같이 id를 얻을 수 있다.<br>

![Image](https://github.com/user-attachments/assets/8e29c463-f3cf-4509-adae-4fd15d37cf88)

그리고  `docker-compose exec web bash`를 통해 접속하면 다음과 같이 /tmp/success가 만들어 진 것을 확인할 수 있다.<br>

![Image](https://github.com/user-attachments/assets/9485b267-b8da-47d5-a028-6bcfa877a747)

command를 통해서도 취약점을 테스트 할 수 있다. 아래의 코드를 실행하면 id가 실행된다.<br>
```
docker run -it --rm --name im -v `pwd`/poc.png:/poc.png vulhub/imagemagick:7.0.8-10 convert /poc.png /poc.gif
```

![Image](https://github.com/user-attachments/assets/d30e621e-4c20-45a7-90dd-0dc7096c3b0c)


</span> 

## 참고 문헌
- https://github.com/vulhub/vulhub/tree/master/ghostscript/CVE-2018-16509
- https://nvd.nist.gov/vuln/detail/CVE-2018-16509